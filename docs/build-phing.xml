<?xml version="1.0" encoding="UTF-8"?>
<project name="phpcompatinfo" default="help" basedir="."
    description="Build the documentation of PHP_CompatInfo">

    <!-- TIP found in ticket#62 (http://www.phing.info/trac/ticket/62) -->
    <php function="dirname" returnProperty="buildfile.dir">
        <param value="${phing.file}"/>
    </php>

    <property name="default.properties" value="${buildfile.dir}/default.properties"/>
    <property name="local.properties" value="${buildfile.dir}/local.win.properties"/>

    <condition property="properties.init">
        <and>
            <available file="${default.properties}" />
            <available file="${local.properties}" />
        </and>
    </condition>

    <fail unless="properties.init" msg="Properties files are not defined or does not exist." />
    <property file="${default.properties}"/>
    <property file="${local.properties}"/>

    <target name="help">
        <phing phingfile="${buildfile.dir}/builddocs.xml" target="help" />
        <echo>------------------------------------------------------------------</echo>
        <echo>make-full-docs           Build the full documentation in all formats </echo>
        <echo>make-html-docs           Build the documentation in HTML format only </echo>

    </target>

    <target name="make-docs">

        <exec dir="${asciidoc.home}"
            command="asciidoc.py -b ${backend} -a linkcss -a icons -a theme=${theme} -a toc2 -o ${output.dir}/CHANGELOG.html ${homedir}/docs/CHANGELOG.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -b ${backend} -a linkcss -a icons -a theme=${theme} -a toc2 -o ${output.dir}/INSTALL.html ${homedir}/docs/INSTALL.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -b ${backend} -a linkcss -a icons -a theme=${theme} -o ${output.dir}/LICENSE.html ${homedir}/docs/LICENSE.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -b ${backend} -a linkcss -a icons -a theme=${theme} -a toc2 -o ${output.dir}/index.html ${homedir}/docs/index.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -b ${backend} -a linkcss -a icons -a theme=${theme} -a toc2 -o ${output.dir}/getting-started.html ${homedir}/docs/getting_started.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -b ${backend} -a linkcss -a icons -a theme=${theme} -a toc2 -o ${output.dir}/basic-usage.html ${homedir}/docs/basic_usage.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -b ${backend} -a linkcss -a icons -a theme=${theme} -a toc2 -o ${output.dir}/command-line.html ${homedir}/docs/command_line.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -b ${backend} -a linkcss -a icons -a theme=${theme} -a toc2 -o ${output.dir}/xml-configuration.html ${homedir}/docs/xml_configuration.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -b ${backend} -a linkcss -a icons -a theme=${theme} -a toc2 -o ${output.dir}/XSLT.html ${homedir}/docs/XSLT.txt"
        />
        <exec dir="${asciidoc.home}"
            command="asciidoc.py -b ${backend} -a linkcss -a icons -a theme=${theme} -a toc2 -o ${output.dir}/UML.html ${homedir}/docs/UML.txt"
        />

    </target>

    <target name="make-full-docs"
            description="Build the full documentation in all formats">

        <phingcall target="make-docs" />
        <phing phingfile="${buildfile.dir}/builddocs.xml" target="make-userguide-all" />

        <phing phingfile="${buildfile.dir}/builddocs.xml" target="notify">
            <property name="growl.message" value="PHP_CompatInfo full documentation build FINISHED." />
        </phing>

    </target>

    <target name="make-html-docs"
            description="Build the documentation in HTML format only">

        <phingcall target="make-docs" />
        <phing phingfile="${buildfile.dir}/builddocs.xml" target="make-userguide-html" />

        <phing phingfile="${buildfile.dir}/builddocs.xml" target="notify">
            <property name="growl.message" value="PHP_CompatInfo HTML documentation build FINISHED." />
        </phing>

    </target>

</project>